# Robot_pet 项目说明

## 项目简介

本项目为全国大学生嵌入式比赛芯片应用赛道的参赛作品——**PawAI Companion：养成系智能宠物交互系统**。

该系统是一个完整的智能宠物交互平台，通过人脸识别、手势识别、云端通信等技术，实现了人与桌面电子宠物之间的自然交互。系统支持多用户管理，具备好感度养成机制，并提供云端同步功能，让用户可以通过手机App实时监控和控制宠物状态。

## 核心价值

- **个性化交互**：通过人脸识别技术识别不同用户，为每个用户维护独立的好感度档案
- **智能响应**：基于手势识别实现自然的人机交互，让宠物能够理解并响应用户动作
- **云端同步**：支持远程监控和控制，用户可通过涂鸦智能App随时了解宠物状态
- **养成体验**：通过好感度系统提供持续的互动动机，增强用户粘性
- **扩展性强**：模块化设计支持功能扩展，如语音交互、更多传感器接入等

---

## 主要功能

### 🎯 用户识别与管理
- **人脸检测与识别**：通过人脸检测-对齐-识别流程提取人脸特征向量
- **多用户支持**：自动识别不同用户，为每个用户维护独立的好感度数据
- **数据持久化**：基于SQLite数据库存储用户信息和好感度历史

### 🤖 智能交互控制
- **手势识别**：订阅 `/hobot_hand_gesture_detection` 话题，实时识别用户手势
- **动作映射**：将识别的手势映射为具体的机器人控制指令
- **串口通信**：通过串口将控制指令发送给下位机，实现机器人动作控制
- **实时反馈**：接收下位机响应，确保指令执行成功

### 📊 好感度养成系统
- **自动增长**：每次成功的交互都会增加好感度
- **实时同步**：好感度变化实时保存到本地数据库
- **云端下发**：支持从云端下发好感度调整指令
- **阈值触发**：好感度达到特定值时解锁隐藏功能

### ☁️ 云端通信与监控
- **MQTT协议**：基于涂鸦云平台实现可靠的云端通信
- **实时上报**：好感度等关键状态实时上报到云端
- **远程控制**：支持通过涂鸦智能App远程监控和调整宠物状态
- **事件驱动**：云端指令下发时立即响应，无需轮询

### 🎙️ 智能对话功能
- **条件解锁**：好感度达到阈值时自动启用语音交互功能
- **大语言模型**：集成大语言模型提供智能对话体验
- **多模态交互**：结合手势、语音等多种交互方式

### 🔧 系统架构特点
- **多线程设计**：串口监听、云端通信等功能在独立线程中运行，保证系统响应性
- **事件驱动**：采用回调机制处理云端指令，避免无效轮询，提高效率
- **模块化结构**：各功能模块独立设计，便于维护和扩展
- **容错处理**：完善的异常处理机制，确保系统稳定运行

---

## 技术栈

- **编程语言**：Python 3
- **机器人框架**：ROS 2 
- **计算机视觉**：OpenCV + 人脸识别模型
- **数据库**：SQLite 3
- **云端通信**：MQTT协议 + 涂鸦IoT平台
- **硬件接口**：Serial通信
- **AI模型**：集成大语言模型API

## 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   用户交互层     │    │    云端服务层    │    │   硬件控制层     │
│                │    │                │    │                │
│ • 人脸识别      │    │ • 涂鸦IoT平台   │    │ • 串口通信      │
│ • 手势识别      │◄──►│ • MQTT协议     │◄──►│ • 下位机控制     │
│ • 语音交互      │    │ • 远程监控      │    │ • 传感器反馈     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                        │                        │
         └────────────────────────┼────────────────────────┘
                                 │
                   ┌─────────────────┐
                   │   核心处理层     │
                   │                │
                   │ • ROS 2节点     │
                   │ • 多线程管理     │
                   │ • 数据持久化     │
                   │ • 状态管理      │
                   └─────────────────┘
```

---

## 主要文件说明

### 核心模块
- **`main/main.py`**  
  系统主入口，负责初始化ROS节点和启动主要功能模块

- **`main/PerceptionMonitor.py`**  
  核心控制节点，集成人脸识别、手势识别、串口通信和云端通信功能

### 功能模块
- **`face_ws/opencv/face_sqlite.py`**  
  本地数据库操作接口，负责用户好感度和人脸特征向量的存储管理

- **`face_ws/opencv/inference.py`**  
  人脸识别推理模块，实现人脸检测、特征提取和身份识别

- **`MQTT/tuya_mqtt.py`**  
  MQTT云端通信模块，处理与涂鸦IoT平台的数据交换和设备控制

- **`LLM_interface/voice_assistant_demo.py`**  
  语音助手模块，集成大语言模型提供智能对话功能

### 算法支持
- **`hand_ws/`**  
  手势识别算法包，基于TROS算法框架实现手势检测和识别

---

## 快速开始

### 环境要求
- Ubuntu 20.04 / 22.04
- ROS 2 Humble/Foxy
- Python 3.8+
- 支持的摄像头设备
- 串口设备 (/dev/ttyS1)

# 启动项目
cd /root/Robot_pet/main
python3 main.py
```

## 功能演示

1. **用户识别**：系统启动后自动进行人脸识别，识别成功后加载对应用户的好感度数据
2. **手势控制**：向摄像头做出预定义手势，观察机器人执行相应动作
3. **好感度增长**：每次成功交互后好感度自动增加，可通过日志查看
4. **云端监控**：通过涂鸦智能App查看实时好感度数据
5. **语音对话**：好感度达到阈值后，特定手势可激活语音对话功能

## 项目特色

- ✅ **完整的IoT解决方案**：从端侧感知到云端服务的全链路实现
- ✅ **用户友好的交互设计**：直观的手势控制和实时反馈
- ✅ **可扩展的架构设计**：支持新增传感器、算法和功能模块
- ✅ **企业级云端集成**：基于涂鸦IoT平台的稳定云服务
- ✅ **实际应用价值**：可直接应用于智能玩具、教育机器人等场景

